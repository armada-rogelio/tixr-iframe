<!DOCTYPE html>
<html>
<head>
  <title>Tixr Conversion Tracker</title>
  <meta charset="utf-8">
</head>
<body>
  <script>
  !function () {
    var i = "cioanalytics",
        analytics = (window[i] = window[i] || []);

    if (!analytics.initialize) {
      if (analytics.invoked) {
        window.console && console.error && console.error("Snippet included twice.");
      } else {
        analytics.invoked = !0;

        analytics.methods = [
          "trackSubmit", "trackClick", "trackLink", "trackForm", "pageview", "identify", "reset",
          "group", "track", "ready", "alias", "debug", "page", "once", "off", "on",
          "addSourceMiddleware", "addIntegrationMiddleware", "setAnonymousId", "addDestinationMiddleware"
        ];

        analytics.factory = function (e) {
          return function () {
            var t = Array.prototype.slice.call(arguments);
            t.unshift(e);
            analytics.push(t);
            return analytics;
          };
        };

        for (var e = 0; e < analytics.methods.length; e++) {
          var key = analytics.methods[e];
          analytics[key] = analytics.factory(key);
        }

        analytics.load = function (key, e) {
          var t = document.createElement("script");
          t.type = "text/javascript";
          t.async = !0;
          t.setAttribute("data-global-customerio-analytics-key", i);
          t.src = "https://cdp.customer.io/v1/analytics-js/snippet/" + key + "/analytics.min.js";
          var n = document.getElementsByTagName("script")[0];
          n.parentNode.insertBefore(t, n);
          analytics._writeKey = key;
          analytics._loadOptions = e;
        };

        analytics.SNIPPET_VERSION = "4.15.3";

        analytics.load(
          "386390ab72390ba7fa9e"
          // Optional: enable anonymous in-app. See https://docs.customer.io/journeys/anonymous-in-app/#enable-anonymous-in-app-messaging.
          /*
          ,{
            integrations: {
              "Customer.io In-App Plugin": {
                anonymousInApp: true
              }
            }
          }
          */
        );

        analytics.page();
      }
    }
  }();
</script>


  <script>
    // Parse query parameters
    function getQueryParams() {
      const params = {};
      const queryString = window.location.search.substring(1);
      const pairs = queryString.split("&");
      for (const pair of pairs) {
        if (!pair) continue;
        const [key, value] = pair.split("=");
        params[decodeURIComponent(key)] = decodeURIComponent(value || "");
      }
      return params;
    }

    (function() {
      const params = getQueryParams();
      const eventName = params.en || 'CustomEvent';

     // Convert params object to URL-encoded format
      const formData = new URLSearchParams();
      for (const key in params) {
        formData.append(key, params[key]);
      }
      
      // Send to Google Sheets without triggering CORS preflight
      fetch('https://script.google.com/macros/s/AKfycbzjqBOamAusB8p3MpbI9eNajoea3Ue2ZGXaQD6I7-AzbD8dLmaPz8wgnkje12fMQvikbA/exec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: formData.toString()
      }).catch(console.error);

      
      // Track event with all params
      cioanalytics.track(eventName, params);

      // If email is present, identify the user
      if (params.email) {
        // cioanalytics.identify({ email: params.email });
      }

      // Track event with all params
      // cioanalytics.track(eventName, params);
    })();
  </script>
</body>
</html>
