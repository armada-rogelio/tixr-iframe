<!DOCTYPE html>
<html>
<head>
  <title>Tixr Conversion Tracker</title>
  <meta charset="utf-8">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2SWF4V7Z0Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
  
    gtag('config', 'G-2SWF4V7Z0Q');
  
    // Wait for page to load, then track all query params dynamically
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const eventData = { event_category: 'iframe' };
  
      // Convert URLSearchParams to plain object
      for (const [key, value] of params.entries()) {
        eventData[key] = value;
      }
  
      gtag('event', 'iframe_page_view', eventData);
    });
  </script>
</head>
<body>
  <script>
  !function () {
    var i = "cioanalytics",
        analytics = (window[i] = window[i] || []);

    if (!analytics.initialize) {
      if (analytics.invoked) {
        window.console && console.error && console.error("Snippet included twice.");
      } else {
        analytics.invoked = !0;

        analytics.methods = [
          "trackSubmit", "trackClick", "trackLink", "trackForm", "pageview", "identify", "reset",
          "group", "track", "ready", "alias", "debug", "page", "once", "off", "on",
          "addSourceMiddleware", "addIntegrationMiddleware", "setAnonymousId", "addDestinationMiddleware"
        ];

        analytics.factory = function (e) {
          return function () {
            var t = Array.prototype.slice.call(arguments);
            t.unshift(e);
            analytics.push(t);
            return analytics;
          };
        };

        for (var e = 0; e < analytics.methods.length; e++) {
          var key = analytics.methods[e];
          analytics[key] = analytics.factory(key);
        }

        analytics.load = function (key, options) {
          var script = document.createElement("script");
          script.type = "text/javascript";
          script.async = true;
          script.setAttribute('data-global-customerio-analytics-key', i);
          //script.src = "https://cdp.customer.io/v1/analytics-js/snippet/" + key + "/analytics.min.js";
          script.src = "https://corsproxy.io/?https://armada-rogelio.github.io/tixr-iframe/analytics.min.js";
    
  
          var firstScript = document.getElementsByTagName("script")[0];
          firstScript.parentNode.insertBefore(script, firstScript);

          analytics._writeKey = key;
          analytics._loadOptions = options;
        };

        analytics.SNIPPET_VERSION = "4.15.3";

        analytics.load(
          "386390ab72390ba7fa9e"
          // Optional: enable anonymous in-app. See https://docs.customer.io/journeys/anonymous-in-app/#enable-anonymous-in-app-messaging.
          /*
          ,{
            integrations: {
              "Customer.io In-App Plugin": {
                anonymousInApp: true
              }
            }
          }
          */
        );

        // analytics.page();
      }
    }
  }();
</script>


  <script>
    // Parse query parameters
    function getQueryParams() {
      const params = {};
      const queryString = window.location.search.substring(1);
      const pairs = queryString.split("&");
      for (const pair of pairs) {
        if (!pair) continue;
        const [key, value] = pair.split("=");
        params[decodeURIComponent(key)] = decodeURIComponent(value || "");
      }
      return params;
    }

    (function() {
      const params = getQueryParams();
      const eventName = params.en || 'CustomEvent';

      
      // Track event with all params
      cioanalytics.track(eventName, params);

      // If email is present, identify the user
      if (params.email) {
        // cioanalytics.identify({ email: params.email });
      }

      // Track event with all params
      // cioanalytics.track(eventName, params);
    })();
  </script>
</body>
</html>
